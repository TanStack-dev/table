---
source-updated-at: '2024-03-28T21:06:30.000Z'
translation-updated-at: '2025-05-02T16:50:14.598Z'
title: å¸¸è§é—®é¢˜è§£ç­”
---
## å¦‚ä½•é¿å…æ— é™æ¸²æŸ“å¾ªç¯ï¼Ÿ

å¦‚æœä½ åœ¨ä½¿ç”¨ Reactï¼Œæœ‰ä¸€ä¸ªå¸¸è§çš„é™·é˜±ä¼šå¯¼è‡´æ— é™æ¸²æŸ“ã€‚å¦‚æœä½ æœªèƒ½ä¸º `columns`ã€`data` æˆ– `state` æä¾›ç¨³å®šçš„å¼•ç”¨ï¼ŒReact ä¼šåœ¨è¡¨æ ¼çŠ¶æ€å‘ç”Ÿä»»ä½•å˜åŒ–æ—¶è¿›å…¥æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ã€‚

ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿè¿™æ˜¯ TanStack Table çš„ bug å—ï¼Ÿ**ä¸æ˜¯**ã€‚*è¿™æ˜¯ React çš„åŸºæœ¬å·¥ä½œåŸç†*ï¼Œæ­£ç¡®ç®¡ç†ä½ çš„åˆ—ã€æ•°æ®å’ŒçŠ¶æ€å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚

TanStack Table çš„è®¾è®¡ä¼šåœ¨ä¼ å…¥è¡¨æ ¼çš„ `data` æˆ– `columns` å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ–è¡¨æ ¼çš„ä»»ä½•çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘é‡æ–°æ¸²æŸ“ã€‚

> æœªèƒ½ä¸º `columns` æˆ– `data` æä¾›ç¨³å®šçš„å¼•ç”¨ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ã€‚

### é™·é˜± 1ï¼šåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶åˆ›å»ºæ–°çš„åˆ—æˆ–æ•°æ®

```js
export default function MyComponent() {
  //ğŸ˜µ é”™è¯¯ï¼šè¿™å°†å¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `columns` åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¢«é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªæ–°æ•°ç»„ï¼
  const columns = [
    // ...
  ];

  //ğŸ˜µ é”™è¯¯ï¼šè¿™å°†å¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `data` åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶è¢«é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªæ–°æ•°ç»„ï¼
  const data = [
    // ...
  ];

  //âŒ åˆ—å’Œæ•°æ®åœ¨ `useReactTable` çš„åŒä¸€ä½œç”¨åŸŸå†…å®šä¹‰ä¸”æ²¡æœ‰ç¨³å®šå¼•ç”¨ï¼Œä¼šå¯¼è‡´æ— é™å¾ªç¯ï¼
  const table = useReactTable({
    columns,
    data,
  });

  return <table>...</table>;
}
```

### è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ useMemo æˆ– useState æä¾›ç¨³å®šå¼•ç”¨

åœ¨ React ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å°†å˜é‡å®šä¹‰åœ¨ç»„ä»¶å¤–éƒ¨/ä¸Šæ–¹ï¼Œæˆ–ä½¿ç”¨ `useMemo`ã€`useState`ï¼Œæˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“ï¼ˆå¦‚ Redux æˆ– React Query ğŸ˜‰ï¼‰æ¥æä¾›â€œç¨³å®šâ€å¼•ç”¨ã€‚

```js
//âœ… æ­£ç¡®ï¼šåœ¨ç»„ä»¶å¤–éƒ¨å®šä¹‰åˆ—
const columns = [
  // ...
];

//âœ… æ­£ç¡®ï¼šåœ¨ç»„ä»¶å¤–éƒ¨å®šä¹‰æ•°æ®
const data = [
  // ...
];

// é€šå¸¸æ›´å®é™…çš„åšæ³•æ˜¯åœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰åˆ—å’Œæ•°æ®ï¼Œå› æ­¤ä½¿ç”¨ `useMemo` æˆ– `useState` æ¥æä¾›ç¨³å®šå¼•ç”¨
export default function MyComponent() {
  //âœ… æ­£ç¡®ï¼šè¿™ä¸ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `columns` æ˜¯ä¸€ä¸ªç¨³å®šå¼•ç”¨
  const columns = useMemo(() => [
    // ...
  ], []);

  //âœ… æ­£ç¡®ï¼šè¿™ä¸ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `data` æ˜¯ä¸€ä¸ªç¨³å®šå¼•ç”¨
  const [data, setData] = useState(() => [
    // ...
  ]);

  // åˆ—å’Œæ•°æ®å…·æœ‰ç¨³å®šå¼•ç”¨ï¼Œä¸ä¼šå¯¼è‡´æ— é™å¾ªç¯ï¼
  const table = useReactTable({
    columns,
    data,
  });

  return <table>...</table>;
}
```

### é™·é˜± 2ï¼šåŸåœ°ä¿®æ”¹åˆ—æˆ–æ•°æ®

å³ä½¿ä½ ä¸ºåˆå§‹çš„ `columns` å’Œ `data` æä¾›äº†ç¨³å®šå¼•ç”¨ï¼Œå¦‚æœä½ åŸåœ°ä¿®æ”¹å®ƒä»¬ï¼Œä»ç„¶å¯èƒ½é™·å…¥æ— é™å¾ªç¯ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„é™·é˜±ï¼Œä¸€å¼€å§‹å¯èƒ½ä¸ä¼šæ³¨æ„åˆ°ã€‚åƒç®€å•çš„å†…è” `data.filter()` è¿™æ ·çš„æ“ä½œå¦‚æœä¸å°å¿ƒå¤„ç†ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æ— é™å¾ªç¯ã€‚

```js
export default function MyComponent() {
  //âœ… æ­£ç¡®
  const columns = useMemo(() => [
    // ...
  ], []);

  //âœ… æ­£ç¡®ï¼ˆReact Query ä¼šè‡ªåŠ¨ä¸ºæ•°æ®æä¾›ç¨³å®šå¼•ç”¨ï¼‰
  const { data, isLoading } = useQuery({
    //...
  });

  const table = useReactTable({
    columns,
    //âŒ é”™è¯¯ï¼šè¿™å°†å¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `data` è¢«åŸåœ°ä¿®æ”¹ï¼ˆç ´åäº†ç¨³å®šå¼•ç”¨ï¼‰
    data: data?.filter(d => d.isActive) ?? [],
  });

  return <table>...</table>;
}
```

### è§£å†³æ–¹æ¡ˆ 2ï¼šç¼“å­˜æ•°æ®è½¬æ¢

ä¸ºäº†é¿å…æ— é™å¾ªç¯ï¼Œä½ åº”è¯¥å§‹ç»ˆç¼“å­˜æ•°æ®è½¬æ¢æ“ä½œã€‚å¯ä»¥ä½¿ç”¨ `useMemo` æˆ–ç±»ä¼¼æ–¹æ³•å®ç°ã€‚

```js
export default function MyComponent() {
  //âœ… æ­£ç¡®
  const columns = useMemo(() => [
    // ...
  ], []);

  //âœ… æ­£ç¡®
  const { data, isLoading } = useQuery({
    //...
  });

  //âœ… æ­£ç¡®ï¼šè¿™ä¸ä¼šå¯¼è‡´æ— é™é‡æ–°æ¸²æŸ“å¾ªç¯ï¼Œå› ä¸º `filteredData` è¢«ç¼“å­˜äº†
  const filteredData = useMemo(() => data?.filter(d => d.isActive) ?? [], [data]);

  const table = useReactTable({
    columns,
    data: filteredData, // ç¨³å®šå¼•ç”¨ï¼
  });

  return <table>...</table>;
}
```

### React Forget

å½“ React Forget å‘å¸ƒåï¼Œè¿™äº›é—®é¢˜å¯èƒ½ä¼šæˆä¸ºè¿‡å»ã€‚æˆ–è€…ç›´æ¥ä½¿ç”¨ Solid.js... ğŸ¤“

## å¦‚ä½•åœ¨æ•°æ®å˜åŒ–æ—¶é˜»æ­¢è¡¨æ ¼çŠ¶æ€è‡ªåŠ¨é‡ç½®ï¼Ÿ

å¤§å¤šæ•°æ’ä»¶ä½¿ç”¨çš„çŠ¶æ€åœ¨æ•°æ®æºå˜åŒ–æ—¶*é€šå¸¸*åº”è¯¥é‡ç½®ï¼Œä½†æœ‰æ—¶å¦‚æœä½ åœ¨å¤–éƒ¨è¿‡æ»¤æ•°æ®ã€ä¸å¯å˜åœ°ç¼–è¾‘æ•°æ®æ—¶æŸ¥çœ‹æ•°æ®ï¼Œæˆ–åªæ˜¯å¯¹æ•°æ®åšä»»ä½•ä¸å¸Œæœ›è§¦å‘è¡¨æ ¼çŠ¶æ€è‡ªåŠ¨é‡ç½®çš„å¤–éƒ¨æ“ä½œæ—¶ï¼Œä½ éœ€è¦é˜»æ­¢è¿™ç§è‡ªåŠ¨é‡ç½®è¡Œä¸ºã€‚

å¯¹äºè¿™äº›æƒ…å†µï¼Œæ¯ä¸ªæ’ä»¶éƒ½æä¾›äº†ç¦ç”¨çŠ¶æ€è‡ªåŠ¨é‡ç½®çš„æ–¹æ³•ã€‚é€šè¿‡å°†å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªè®¾ç½®ä¸º `false`ï¼Œä½ å¯ä»¥é˜»æ­¢è‡ªåŠ¨é‡ç½®è¢«è§¦å‘ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº React çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†åœ¨ç¼–è¾‘è¡¨æ ¼çš„ `data` æºæ—¶é˜»æ­¢æ‰€æœ‰çŠ¶æ€è‡ªåŠ¨é‡ç½®çš„æ–¹æ³•ï¼š

```js
const [data, setData] = React.useState([])
const skipPageResetRef = React.useRef()

const updateData = newData => {
  // å½“é€šè¿‡æ­¤å‡½æ•°æ›´æ–°æ•°æ®æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªæ ‡å¿—
  // ä»¥ç¦ç”¨æ‰€æœ‰è‡ªåŠ¨é‡ç½®
  skipPageResetRef.current = true

  setData(newData)
}

React.useEffect(() => {
  // è¡¨æ ¼æ›´æ–°åï¼Œå§‹ç»ˆç§»é™¤æ ‡å¿—
  skipPageResetRef.current = false
})

useReactTable({
  ...
  autoResetPageIndex: !skipPageResetRef.current,
  autoResetExpanded: !skipPageResetRef.current,
})
```

ç°åœ¨ï¼Œå½“æˆ‘ä»¬æ›´æ–°æ•°æ®æ—¶ï¼Œä¸Šè¿°è¡¨æ ¼çŠ¶æ€å°†ä¸ä¼šè‡ªåŠ¨é‡ç½®ï¼
